<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diffusion Lab</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
</head>
<body>
    <div class="container-fluid">
        <!-- Header -->
        <header class="text-center py-4 bg-dark text-white">
            <h1><i class="fas fa-flask"></i> Diffusion Lab</h1>
            <p class="lead">Create storyboards, art, and more with AI-powered diffusion models</p>
        </header>

        <div class="row">
            <!-- Input Panel -->
            <div class="col-lg-4 col-md-5">
                <div class="card shadow-sm mt-4">
                    <div class="card-header bg-primary text-white">
                        <h5><i class="fas fa-edit"></i> Scene Description</h5>
                    </div>
                    <div class="card-body">
                        <form id="storyboardForm">
                            <!-- Add Mode Selector (Generation Type) at the top -->
                            <div class="mb-3">
                                <label for="generationMode" class="form-label">Generation Type:</label>
                                <select class="form-select" id="generationMode">
                                    <option value="single">Single-Image Art</option>
                                    <option value="storyboard">Storyboard (5 panels)</option>
                                    <option value="batch">Batch Generation (Multiple Variations)</option>
                                    <option value="controlnet">ControlNet (Precise Control)</option>
                                    <option value="img2img">Image-to-Image</option>
                                    <option value="inpainting">Inpainting (Content-aware Fill)</option>
                                    <option value="prompt-chaining">Prompt Chaining (Story Evolution)</option>
                                </select>
                                <div class="form-text">Choose to generate a single art piece, storyboard, transform an image, or fill masked areas.</div>
                            </div>

                            <div class="mb-3" id="mainPromptSection">
                                <label for="prompt" class="form-label">Describe your scene:</label>
                                <textarea 
                                    class="form-control" 
                                    id="prompt" 
                                    rows="4" 
                                    placeholder="e.g., A detective walks into a neon-lit alley at midnight, rain pouring down"></textarea>
                                <div class="form-text">Describe the scene you want to visualize (minimum 10 characters)</div>
                            </div>

                            <!-- Example Prompts -->
                            <div class="mb-3">
                                <h6><i class="fas fa-lightbulb"></i> Example Prompts: <span id="currentModeIndicator" class="badge bg-primary ms-2">Single Image</span></h6>
                                
                                <!-- Tab Navigation -->
                                <ul class="nav nav-tabs nav-fill" id="exampleTabs" role="tablist">
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link active" id="single-tab" data-bs-toggle="tab" data-bs-target="#single-examples" type="button" role="tab">
                                            <i class="fas fa-image"></i> Single Image
                                        </button>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link" id="storyboard-tab" data-bs-toggle="tab" data-bs-target="#storyboard-examples" type="button" role="tab">
                                            <i class="fas fa-film"></i> Storyboard
                                        </button>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link" id="batch-tab" data-bs-toggle="tab" data-bs-target="#batch-examples" type="button" role="tab">
                                            <i class="fas fa-layer-group"></i> Batch
                                        </button>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link" id="controlnet-tab" data-bs-toggle="tab" data-bs-target="#controlnet-examples" type="button" role="tab">
                                            <i class="fas fa-crosshairs"></i> ControlNet
                                        </button>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link" id="img2img-tab" data-bs-toggle="tab" data-bs-target="#img2img-examples" type="button" role="tab">
                                            <i class="fas fa-exchange-alt"></i> Image-to-Image
                                        </button>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link" id="inpainting-tab" data-bs-toggle="tab" data-bs-target="#inpainting-examples" type="button" role="tab">
                                            <i class="fas fa-magic"></i> Inpainting
                                        </button>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link" id="prompt-chaining-tab" data-bs-toggle="tab" data-bs-target="#prompt-chaining-examples" type="button" role="tab">
                                            <i class="fas fa-link"></i> Story Evolution
                                        </button>
                                    </li>
                                </ul>
                                
                                <!-- Tab Content -->
                                <div class="tab-content" id="exampleTabContent">
                                    <!-- Single Image Examples (now first) -->
                                    <div class="tab-pane fade show active" id="single-examples" role="tabpanel">
                                        <div class="list-group list-group-flush mt-2">
                                                                                        <button type="button" class="list-group-item list-group-item-action example-prompt"
                                                    data-prompt="A cyberpunk cityscape with towering neon skyscrapers and flying cars">
                                                üåÉ Cyberpunk cityscape
                                            </button>
                                            <button type="button" class="list-group-item list-group-item-action example-prompt" 
                                                    data-prompt="A majestic castle floating in the clouds with waterfalls cascading down">
                                                üè∞ Floating castle in the clouds
                                            </button>
                                            <button type="button" class="list-group-item list-group-item-action example-prompt" 
                                                    data-prompt="A futuristic robot warrior in a neon-lit battlefield">
                                                ‚ö° Futuristic robot warrior
                                            </button>
                                            <button type="button" class="list-group-item list-group-item-action example-prompt" 
                                                    data-prompt="A magical forest with glowing mushrooms and fairy lights">
                                                üåü Magical forest with glowing mushrooms
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <!-- Storyboard Examples -->
                                    <div class="tab-pane fade" id="storyboard-examples" role="tabpanel">
                                        <div class="list-group list-group-flush mt-2">
                                            <button type="button" class="list-group-item list-group-item-action example-prompt" 
                                                    data-prompt="A detective walks into a neon-lit alley at midnight, rain pouring down">
                                                üïµÔ∏è Detective in neon-lit alley
                                            </button>
                                            <button type="button" class="list-group-item list-group-item-action example-prompt" 
                                                    data-prompt="A robot wanders a post-apocalyptic desert searching for signs of life">
                                                ü§ñ Robot in post-apocalyptic desert
                                            </button>
                                            <button type="button" class="list-group-item list-group-item-action example-prompt" 
                                                    data-prompt="A young wizard discovers an ancient library hidden in the mountains">
                                                üßô‚Äç‚ôÇÔ∏è Wizard discovers ancient library
                                            </button>
                                            <button type="button" class="list-group-item list-group-item-action example-prompt" 
                                                    data-prompt="A spaceship crew encounters an alien artifact on a distant planet">
                                                üöÄ Spaceship crew finds alien artifact
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <!-- Batch Generation Examples -->
                                    <div class="tab-pane fade" id="batch-examples" role="tabpanel">
                                        <div class="list-group list-group-flush mt-2">
                                            <button type="button" class="list-group-item list-group-item-action example-prompt" 
                                                    data-prompt="A futuristic cityscape with flying cars and neon lights">
                                                üåÉ Futuristic Cityscape Variations
                                            </button>
                                            <button type="button" class="list-group-item list-group-item-action example-prompt" 
                                                    data-prompt="A magical forest with glowing mushrooms and fairy lights">
                                                üå≤ Magical Forest Variations
                                            </button>
                                            <button type="button" class="list-group-item list-group-item-action example-prompt" 
                                                    data-prompt="A steampunk airship floating through clouds">
                                                üöÅ Steampunk Airship Variations
                                            </button>
                                            <button type="button" class="list-group-item list-group-item-action example-prompt" 
                                                    data-prompt="A cyberpunk warrior in a neon-lit alley">
                                                ‚ö° Cyberpunk Warrior Variations
                                            </button>
                                            <button type="button" class="list-group-item list-group-item-action example-prompt" 
                                                    data-prompt="A serene mountain landscape at sunset">
                                                üèîÔ∏è Mountain Landscape Variations
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <!-- ControlNet Examples -->
                                    <div class="tab-pane fade" id="controlnet-examples" role="tabpanel">
                                        <div class="list-group list-group-flush mt-2">
                                            <button type="button" class="list-group-item list-group-item-action example-prompt" 
                                                    data-prompt="A majestic dragon in a fantasy landscape">
                                                üêâ Canny Edge: Dragon with line art control
                                            </button>
                                            <button type="button" class="list-group-item list-group-item-action example-prompt" 
                                                    data-prompt="A futuristic cityscape with towering buildings">
                                                üèôÔ∏è Depth Map: 3D city with depth control
                                            </button>
                                            <button type="button" class="list-group-item list-group-item-action example-prompt" 
                                                    data-prompt="A warrior in battle stance with sword drawn">
                                                ‚öîÔ∏è Pose Control: Character with pose reference
                                            </button>
                                            <button type="button" class="list-group-item list-group-item-action example-prompt" 
                                                    data-prompt="A magical forest with glowing mushrooms and fairy lights">
                                                üå≤ Segmentation: Scene with object placement control
                                            </button>
                                            <button type="button" class="list-group-item list-group-item-action example-prompt" 
                                                    data-prompt="A cyberpunk character in neon-lit alley">
                                                üåÉ Edge Detection: Character with precise outline control
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <!-- Image-to-Image Examples -->
                                    <div class="tab-pane fade" id="img2img-examples" role="tabpanel">
                                        <div class="list-group list-group-flush mt-2">
                                            <button type="button" class="list-group-item list-group-item-action example-prompt" 
                                                    data-prompt="A detailed oil painting of a majestic dragon in a fantasy landscape">
                                                üé® Sketch to Art: Dragon painting
                                            </button>
                                            <button type="button" class="list-group-item list-group-item-action example-prompt" 
                                                    data-prompt="A sharp, professional photograph with enhanced details and vibrant colors">
                                                üì∏ Photo Enhancement: Sharp & vibrant
                                            </button>
                                            <button type="button" class="list-group-item list-group-item-action example-prompt" 
                                                    data-prompt="A renaissance-style oil painting with dramatic lighting and rich textures">
                                                üñºÔ∏è Style Transfer: Renaissance portrait
                                            </button>
                                            <button type="button" class="list-group-item list-group-item-action example-prompt" 
                                                    data-prompt="A polished character design for a sci-fi video game protagonist">
                                                üéÆ Concept Design: Sci-fi character
                                            </button>
                                            <button type="button" class="list-group-item list-group-item-action example-prompt" 
                                                    data-prompt="A watercolor painting with soft, dreamy colors and flowing brushstrokes">
                                                üé® Style Transfer: Watercolor painting
                                            </button>
                                        </div>
                                    </div>

                                    <!-- Inpainting Examples -->
                                    <div class="tab-pane fade" id="inpainting-examples" role="tabpanel">
                                        <div class="list-group list-group-flush mt-2">
                                            <button type="button" class="list-group-item list-group-item-action example-prompt" 
                                                    data-prompt="A beautiful flower garden with colorful blooms">
                                                üå∏ Fill with: Flower garden
                                            </button>
                                            <button type="button" class="list-group-item list-group-item-action example-prompt" 
                                                    data-prompt="A modern glass window with city skyline view">
                                                üè¢ Fill with: Modern window
                                            </button>
                                            <button type="button" class="list-group-item list-group-item-action example-prompt" 
                                                    data-prompt="A cozy fireplace with crackling flames">
                                                üî• Fill with: Fireplace
                                            </button>
                                            <button type="button" class="list-group-item list-group-item-action example-prompt" 
                                                    data-prompt="A vintage wooden door with ornate carvings">
                                                üö™ Fill with: Vintage door
                                            </button>
                                            <button type="button" class="list-group-item list-group-item-action example-prompt" 
                                                    data-prompt="A serene lake with mountain reflections">
                                                üèîÔ∏è Fill with: Mountain lake
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <!-- Prompt Chaining Examples -->
                                    <div class="tab-pane fade" id="prompt-chaining-examples" role="tabpanel">
                                        <div class="list-group list-group-flush mt-2">
                                            <button type="button" class="list-group-item list-group-item-action example-prompt-chain" 
                                                    data-prompts='["A young adventurer enters a mysterious forest", "The adventurer discovers an ancient temple hidden among towering trees", "Inside the temple, the adventurer finds a glowing crystal on an ornate pedestal", "The crystal awakens and begins to levitate, pulsing with magical energy", "The adventurer reaches out to touch the crystal, becoming filled with magical power"]'>
                                                ‚ú® Young Adventurer's Quest
                                            </button>
                                            <button type="button" class="list-group-item list-group-item-action example-prompt-chain" 
                                                    data-prompts='["A detective arrives at a crime scene in a dark alley", "The detective discovers mysterious clues that seem supernatural in nature", "Following the clues leads to an abandoned warehouse with strange symbols", "Inside the warehouse, the detective encounters otherworldly creatures", "The detective realizes this case involves a portal to another dimension"]'>
                                                üïµÔ∏è Supernatural Detective Story
                                            </button>
                                            <button type="button" class="list-group-item list-group-item-action example-prompt-chain" 
                                                    data-prompts='["A lone robot awakens in a post-apocalyptic wasteland", "The robot begins searching through abandoned cities for signs of life", "In a collapsed library, the robot finds preserved books and starts learning", "The robot discovers a hidden underground bunker with sleeping humans", "The robot successfully awakens the humans and helps rebuild civilization"]'>
                                                ü§ñ Post-Apocalyptic Revival
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label for="style" class="form-label">Visual Style:</label>
                                <select class="form-select" id="style" required>
                                    {% for key, style in styles.items() %}
                                    <option value="{{ key }}" data-description="{{ style.description }}" data-color="{{ style.color }}">
                                        {{ style.name }}
                                    </option>
                                    {% endfor %}
                                </select>
                                <div class="form-text" id="styleDescription">Professional film-style with dramatic lighting</div>
                            </div>



                            <!-- Image-to-Image Upload Section -->
                            <div class="mb-3" id="img2imgSection" style="display: none;">
                                <label for="inputImage" class="form-label">Input Image (for Image-to-Image):</label>
                                <input type="file" class="form-control" id="inputImage" accept="image/*">
                                <div class="form-text">Upload an image to transform it with your prompt. Works best with sketches, photos, or rough concepts.</div>
                                
                                <!-- Placeholder Image -->
                                <div class="mt-2" id="img2imgPlaceholder">
                                    <div class="border-2 border-dashed border-secondary rounded p-4 text-center" style="border-style: dashed; min-height: 200px; display: flex; align-items: center; justify-content: center; background-color: #f8f9fa;">
                                        <div>
                                            <i class="fas fa-image fa-3x text-muted mb-3 placeholder-icon"></i>
                                            <h6 class="text-muted">No Image Selected</h6>
                                            <p class="text-muted mb-0">Upload an image to see the preview here</p>
                                            <small class="text-muted">Supports: JPG, PNG, GIF, BMP, WebP</small>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mt-2" id="imagePreview" style="display: none;">
                                    <img id="previewImg" class="img-fluid rounded" style="max-height: 200px;">
                                    <button type="button" class="btn btn-sm btn-outline-danger mt-1" id="removeImage">
                                        <i class="fas fa-times"></i> Remove Image
                                    </button>
                                </div>
                                
                                <div class="mt-2">
                                    <label for="strengthSlider" class="form-label">Transformation Strength: <span id="strengthValue">0.75</span></label>
                                    <input type="range" class="form-range" id="strengthSlider" min="0.1" max="1.0" step="0.05" value="0.75">
                                    <div class="form-text">
                                        <small>0.1 = Keep original, 1.0 = Complete transformation</small>
                                    </div>
                                </div>
                            </div>

                            <!-- Inpainting Section -->
                            <div class="mb-3" id="inpaintingSection" style="display: none;">
                                <label for="inpaintingImage" class="form-label">Input Image (for Inpainting):</label>
                                <input type="file" class="form-control" id="inpaintingImage" accept="image/*">
                                <div class="form-text">Upload an image and draw masks on areas you want to change or fill.</div>
                                
                                <!-- Placeholder Image -->
                                <div class="mt-2" id="inpaintingPlaceholder">
                                    <div class="border-2 border-dashed border-secondary rounded p-4 text-center" style="border-style: dashed; min-height: 200px; display: flex; align-items: center; justify-content: center; background-color: #f8f9fa;">
                                        <div>
                                            <i class="fas fa-magic fa-3x text-muted mb-3 placeholder-icon"></i>
                                            <h6 class="text-muted">No Image Selected</h6>
                                            <p class="text-muted mb-0">Upload an image to start inpainting</p>
                                            <small class="text-muted">Supports: JPG, PNG, GIF, BMP, WebP</small>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mt-3" id="inpaintingCanvasContainer" style="display: none;">
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <h6 class="mb-0">Draw Mask:</h6>
                                        <div class="btn-group btn-group-sm" role="group">
                                            <button type="button" class="btn btn-outline-primary active" id="brushTool" data-tool="brush">
                                                <i class="fas fa-paint-brush"></i> Brush
                                            </button>
                                            <button type="button" class="btn btn-outline-secondary" id="eraserTool" data-tool="eraser">
                                                <i class="fas fa-eraser"></i> Eraser
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <div class="position-relative" style="border: 2px solid #dee2e6; border-radius: 8px; overflow: hidden;">
                                        <canvas id="inpaintingCanvas" width="512" height="512" style="max-width: 100%; height: auto; cursor: crosshair;"></canvas>
                                        <div class="position-absolute top-0 start-0 p-2">
                                            <small class="text-white bg-dark bg-opacity-75 px-2 py-1 rounded">Draw red brush strokes on areas you want to change</small>
                                        </div>
                                        <div class="position-absolute top-0 end-0 p-2">
                                            <small class="text-white bg-danger bg-opacity-75 px-2 py-1 rounded">Red = Masked Area</small>
                                        </div>
                                    </div>
                                    
                                    <div class="mt-2 d-flex gap-2">
                                        <button type="button" class="btn btn-sm btn-outline-warning" id="clearMask">
                                            <i class="fas fa-trash"></i> Clear Mask
                                        </button>
                                        <button type="button" class="btn btn-sm btn-outline-info" id="invertMask">
                                            <i class="fas fa-exchange-alt"></i> Invert Mask
                                        </button>
                                        <button type="button" class="btn btn-sm btn-outline-success" id="previewMask">
                                            <i class="fas fa-eye"></i> Preview
                                        </button>
                                        <button type="button" class="btn btn-sm btn-outline-info" id="testMask">
                                            <i class="fas fa-vial"></i> Test Mask
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="mt-2" id="inpaintingPreview" style="display: none;">
                                    <img id="inpaintingPreviewImg" class="img-fluid rounded" style="max-height: 200px;">
                                    <button type="button" class="btn btn-sm btn-outline-danger mt-1" id="removeInpaintingImage">
                                        <i class="fas fa-times"></i> Remove Image
                                    </button>
                                </div>
                            </div>

                            <!-- Prompt Chaining Section -->
                            <div class="mb-3" id="promptChainingSection" style="display: none;">
                                <label class="form-label">Story Evolution Prompts:</label>
                                <div class="form-text mb-2">Create a sequence of prompts that tell a story. Each image will build upon the previous one.</div>
                                
                                <div id="promptChainContainer">
                                    <div class="prompt-chain-item mb-3" data-step="1">
                                        <div class="d-flex align-items-center mb-2">
                                            <span class="badge bg-primary me-2">Step 1</span>
                                            <button type="button" class="btn btn-sm btn-outline-danger ms-auto" onclick="removePromptStep(this)">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </div>
                                        <textarea class="form-control prompt-input" rows="2" 
                                            placeholder="e.g., A young adventurer stands at the entrance of a mysterious cave"></textarea>
                                    </div>
                                </div>
                                
                                <div class="d-flex gap-2 mb-3">
                                    <button type="button" class="btn btn-outline-primary btn-sm" id="addPromptStep">
                                        <i class="fas fa-plus"></i> Add Step
                                    </button>
                                    <button type="button" class="btn btn-outline-info btn-sm" id="loadTemplate">
                                        <i class="fas fa-file-alt"></i> Load Template
                                    </button>
                                    <button type="button" class="btn btn-outline-warning btn-sm" id="clearPrompts">
                                        <i class="fas fa-trash"></i> Clear All
                                    </button>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="evolutionStrength" class="form-label">Evolution Strength: <span id="strengthValue2">0.3</span></label>
                                    <input type="range" class="form-range" id="evolutionStrength" min="0.0" max="1.0" step="0.1" value="0.3">
                                    <div class="form-text">
                                        <small>0.0 = Each image is independent, 1.0 = Each image heavily influences the next</small>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="chainLayout" class="form-label">Layout:</label>
                                    <select class="form-select" id="chainLayout">
                                        <option value="horizontal">Horizontal (side by side)</option>
                                        <option value="vertical">Vertical (stacked)</option>
                                        <option value="grid">Grid (2x3)</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Batch Generation Section -->
                            <div class="mb-3" id="batchSection" style="display: none;">
                                <label class="form-label">Batch Generation Settings:</label>
                                <div class="form-text mb-2">Generate multiple variations of the same prompt to explore creative diversity.</div>
                                
                                <div class="mb-3">
                                    <label for="batchCount" class="form-label">Number of Variations: <span id="batchCountValue">4</span></label>
                                    <input type="range" class="form-range" id="batchCount" min="2" max="8" step="1" value="4">
                                    <div class="form-text">
                                        <small>Generate 2-8 variations of your prompt</small>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="batchLayout" class="form-label">Layout:</label>
                                    <select class="form-select" id="batchLayout">
                                        <option value="grid">Grid (2x2, 2x3, 2x4)</option>
                                        <option value="horizontal">Horizontal (side by side)</option>
                                        <option value="vertical">Vertical (stacked)</option>
                                    </select>
                                    <div class="form-text">
                                        <small>How to arrange the generated variations</small>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="variationStrength" class="form-label">Variation Strength: <span id="variationStrengthValue">0.5</span></label>
                                    <input type="range" class="form-range" id="variationStrength" min="0.1" max="1.0" step="0.1" value="0.5">
                                    <div class="form-text">
                                        <small>0.1 = Similar variations, 1.0 = Very different variations</small>
                                    </div>
                                </div>
                            </div>

                            <!-- ControlNet Section -->
                            <div class="mb-3" id="controlnetSection" style="display: none;">
                                <label class="form-label">ControlNet Settings:</label>
                                <div class="form-text mb-2">Upload a reference image to control the composition, pose, or structure of your generation.</div>
                                
                                <div class="mb-3">
                                    <label for="controlnetImage" class="form-label">Reference Image:</label>
                                    <input type="file" class="form-control" id="controlnetImage" accept="image/*">
                                    <div class="form-text">Upload an image to use as a control reference (line art, depth map, pose, etc.)</div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="controlnetModel" class="form-label">Control Type:</label>
                                    <select class="form-select" id="controlnetModel">
                                        <option value="canny">Canny Edge Detection</option>
                                        <option value="depth">Depth Map</option>
                                        <option value="pose">Human Pose</option>
                                        <option value="segmentation">Semantic Segmentation</option>
                                    </select>
                                    <div class="form-text">Choose the type of control you want to apply</div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="controlStrength" class="form-label">Control Strength: <span id="controlStrengthValue">1.0</span></label>
                                    <input type="range" class="form-range" id="controlStrength" min="0.0" max="2.0" step="0.1" value="1.0">
                                    <div class="form-text">
                                        <small>0.0 = No control, 1.0 = Full control, 2.0 = Strong control</small>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="guidanceStart" class="form-label">Guidance Start: <span id="guidanceStartValue">0.0</span></label>
                                    <input type="range" class="form-range" id="guidanceStart" min="0.0" max="1.0" step="0.1" value="0.0">
                                    <div class="form-text">
                                        <small>When to start applying control (0.0 = beginning, 1.0 = end)</small>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="guidanceEnd" class="form-label">Guidance End: <span id="guidanceEndValue">1.0</span></label>
                                    <input type="range" class="form-range" id="guidanceEnd" min="0.0" max="1.0" step="0.1" value="1.0">
                                    <div class="form-text">
                                        <small>When to stop applying control (0.0 = beginning, 1.0 = end)</small>
                                    </div>
                                </div>
                                
                                <!-- ControlNet Preview -->
                                <div class="mt-2" id="controlnetPreview" style="display: none;">
                                    <img id="controlnetPreviewImg" class="img-fluid rounded" style="max-height: 200px;">
                                    <button type="button" class="btn btn-sm btn-outline-danger mt-1" id="removeControlnetImage">
                                        <i class="fas fa-times"></i> Remove Image
                                    </button>
                                </div>
                            </div>

                            <button type="submit" class="btn btn-primary btn-lg w-100" id="generateBtn">
                                <i class="fas fa-magic"></i> Generate
                            </button>
                        </form>

                    </div>
                </div>
            </div>

            <!-- Output Panel -->
            <div class="col-lg-8 col-md-7">
                <div class="card shadow-sm mt-4">
                    <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                        <h5><i class="fas fa-images"></i> Generated Output</h5>
                        <div id="downloadSection" class="d-none">
                            <button class="btn btn-light btn-sm" id="downloadBtn">
                                <i class="fas fa-download"></i> Download PNG
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div id="storyboardContainer" class="text-center">
                            <div class="placeholder-content">
                                <i class="fas fa-image fa-4x text-muted mb-3"></i>
                                <h5 class="text-muted">Your output will appear here</h5>
                                <p class="text-muted">Enter a prompt and choose a mode to get started</p>
                            </div>
                        </div>
                        <div id="singleImageContainer" class="text-center d-none">
                            <div class="placeholder-content">
                                <i class="fas fa-image fa-4x text-muted mb-3"></i>
                                <h5 class="text-muted">Your generated image will appear here</h5>
                                <p class="text-muted">Click "Generate" to create AI art</p>
                            </div>
                        </div>
                        <div id="img2imgContainer" class="text-center d-none">
                            <div class="placeholder-content">
                                <i class="fas fa-exchange-alt fa-4x text-muted mb-3"></i>
                                <h5 class="text-muted">Your transformed image will appear here</h5>
                                <p class="text-muted">Upload an image and click "Generate"</p>
                            </div>
                        </div>
                        <div id="inpaintingContainer" class="text-center d-none">
                            <div class="placeholder-content">
                                <i class="fas fa-magic fa-4x text-muted mb-3"></i>
                                <h5 class="text-muted">Your inpainted image will appear here</h5>
                                <p class="text-muted">Upload an image with mask and click "Generate"</p>
                            </div>
                        </div>
                        <div id="batchContainer" class="text-center d-none">
                            <div class="placeholder-content">
                                <i class="fas fa-layer-group fa-4x text-muted mb-3"></i>
                                <h5 class="text-muted">Your batch images will appear here</h5>
                                <p class="text-muted">Enter prompts and click "Generate"</p>
                            </div>
                        </div>
                        <div id="controlnetContainer" class="text-center d-none">
                            <div class="placeholder-content">
                                <i class="fas fa-crosshairs fa-4x text-muted mb-3"></i>
                                <h5 class="text-muted">Your ControlNet image will appear here</h5>
                                <p class="text-muted">Upload reference image and click "Generate"</p>
                            </div>
                        </div>
                        <div id="promptChainingContainer" class="text-center d-none">
                            <div class="placeholder-content">
                                <i class="fas fa-link fa-4x text-muted mb-3"></i>
                                <h5 class="text-muted">Your story evolution will appear here</h5>
                                <p class="text-muted">Enter scene descriptions and click "Generate"</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Status Card -->
        <div class="row">
            <div class="col-12">
                <div class="card shadow-sm mt-4">
                    <div class="card-header bg-info text-white">
                        <h6><i class="fas fa-info-circle"></i> Status</h6>
                    </div>
                    <div class="card-body">
                        <div id="status" class="text-muted">Ready to generate</div>
                        <div class="progress mt-2 d-none" id="progressBar">
                            <div class="progress-bar progress-bar-striped progress-bar-animated" 
                                 role="progressbar" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- AI Loading Modal -->
        <div class="modal fade" id="aiLoadingModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-body text-center p-5">
                        <div class="spinner-border text-primary mb-3" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <h5 id="loadingTitle">Generating with AI</h5>
                        <p class="text-muted" id="loadingDescription">This may take up to a minute depending on your hardware.</p>
                        <button type="button" class="btn btn-outline-danger mt-3" id="aiCancelBtn" data-bs-dismiss="modal">
                            <i class="fas fa-times"></i> Cancel
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        <script src="{{ url_for('static', filename='js/app.js') }}"></script>
    </body>
    </html>
